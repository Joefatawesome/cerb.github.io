<script src='https://www.google.com/recaptcha/api.js'></script>

<form id="frmCerbFreeLicense" class="cerb-form" action="javascript:;" method="POST" onsubmit="return false;">
	<input type="hidden" name="deploy" value="license">
	<input type="hidden" name="g-recaptcha-response" value="">
	
	<fieldset>
		<legend style="color:black;">Want a free 3-seat license to get started?</legend>
	
		<label for="org">Organization:</label>
		<input type="text" name="org" value="" placeholder="Example, Inc." autocomplete="off" spellcheck="false">
	
		<label for="email">Email Address:</label>
		<input type="text" name="email" value="" placeholder="you@example.com" autocomplete="off" spellcheck="false">
	
		<div class="g-recaptcha" data-sitekey="6LeOPh0TAAAAANiEBFZLURt43IkCTUMOPUSMoxL9"></div>
		
		<div style="margin-top:20px;">
			<input type="button" class="submit" value="Email me a free license">
			<div class="status"></div>
			
			<div>
				<small>You can use your free 3-seat license forever at no cost. You can choose to upgrade to a Pro license at any time. You're entitled to one free renewal of this license every 12 months; at which point you can upgrade to the latest version. We hope you find Cerb to be useful.</small>
			</div>
		</div>
	</fieldset>
</form>

<script type="text/javascript">
$(function() {
	var $frm = $('#frmCerbFreeLicense');
	
	$frm.find('input.submit').click(function() {
		// [TODO] Spinner
		
		// Captcha
		$frm.find('input:hidden[name=g-recaptcha-response]').val(grecaptcha.getResponse());
		
		$.ajax({
			method: 'POST',
			url: 'https://cerb.official.support/forms/cloud/signup',
			crossDomain: true,
			dataType: 'json',
			data: $frm.serialize(),
			success: function(res) {
				if(res && res.error) {
					grecaptcha.reset();
					
					var $warn = $('<div class="warning"/>').text(res.error);
					$frm.find('div.status').html($warn);
					return;
				}
				
				if(res && res.success) {
					var $success = $('<div class="success"/>').text(res.success);
					$frm.find('div.status').html($success);
					$frm.find('input.submit').hide();
				}
			},
			error: function(e) {
				grecaptcha.reset();
				
				var $warn = $('<div class="error"/>').text("An unexpected error occurred. Please try again later.");
				$frm.find('div.status').html($warn);
				return;
			}
		})
	});
});
</script>